{"resourceType":"Library","extension":[{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode","valueCoding":{"system":"http://terminology.hl7.org/CodeSystem/condition-clinical","code":"active"}},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode","valueCoding":{"system":"http://terminology.hl7.org/CodeSystem/condition-clinical","code":"recurrence"}},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-directReferenceCode","valueCoding":{"system":"http://terminology.hl7.org/CodeSystem/condition-clinical","code":"relapse"}},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DataRequirementHelper"},{"url":"name","valueString":"Retrieve Def"},{"url":"statement","valueString":"// Data Requirements should be able to be mapped back to the Element that is passed into the function\n// In this case, the onset element can be traced back to the Condition that was passed into the prevalenceInterval function\n\n// Why isn't onset being returned\n\n//Expected Data Requirements\n// Condition\n//  Valueset - 2.16.840.1.113883.3.600.1.1623\n//  Must Support - code, onset \n\ndefine \"Retrieve Def\":\n  [Condition: \"Retrieve VS\"] Retrieve\n    where Retrieve.prevalenceInterval ( ) overlaps before \"Measurement Period\""},{"url":"displaySequence","valueInteger":0}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DoubleFunctionHelpers"},{"url":"name","valueString":"prevalenceInterval"},{"url":"statement","valueString":"// define fluent function prevalenceInterval(condition Condition):\n// if condition.clinicalStatus ~ \"active\"\n// \tthen\n//   \t\tInterval[start of condition.onset.toInterval(), end of condition.onset.toInterval()]\n// \telse\n//   \t\tInterval[start of condition.onset.toInterval(), end of condition.onset.toInterval())\n\n// define fluent function toInterval(choice Choice<DateTime, Quantity, Interval<DateTime>, Interval<Quantity>>):\n//   case\n//     when choice is DateTime then Interval[choice as DateTime, choice as DateTime]\n//     else null as Interval<DateTime>end\n\ndefine fluent function prevalenceInterval(condition Condition):\nif condition.clinicalStatus ~ \"active\"\n  or condition.clinicalStatus ~ \"recurrence\"\n  or condition.clinicalStatus ~ \"relapse\" then\n  Interval[start of condition.onset.toInterval(), end of condition.abatementInterval()]\nelse\n  Interval[start of condition.onset.toInterval(), end of condition.abatementInterval())"},{"url":"displaySequence","valueInteger":1}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DoubleFunctionHelpers"},{"url":"name","valueString":"toInterval"},{"url":"statement","valueString":"define fluent function toInterval(choice Choice<DateTime, Quantity, Interval<DateTime>, Interval<Quantity>>):\n  case\n    when choice is DateTime then Interval[choice as DateTime, choice as DateTime]\n    else null as Interval<DateTime>end"},{"url":"displaySequence","valueInteger":2}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DoubleFunctionHelpers"},{"url":"name","valueString":"abatementInterval"},{"url":"statement","valueString":"define fluent function abatementInterval(condition Condition):\n\tInterval[condition.abatement.low, condition.abatement.high)"},{"url":"displaySequence","valueInteger":3}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DataRequirementHelper"},{"url":"name","valueString":"prevalenceInterval"},{"url":"statement","valueString":"// define fluent function prevalenceInterval(condition Condition):\n// if condition.clinicalStatus ~ \"active\"\n// \tthen\n//   \t\tInterval[start of condition.onset.toInterval(), end of condition.onset.toInterval()]\n// \telse\n//   \t\tInterval[start of condition.onset.toInterval(), end of condition.onset.toInterval())\n\n// define fluent function toInterval(choice Choice<DateTime, Quantity, Interval<DateTime>, Interval<Quantity>>):\n//   case\n//     when choice is DateTime then Interval[choice as DateTime, choice as DateTime]\n//     else null as Interval<DateTime>end\n\ndefine fluent function prevalenceInterval(condition Condition):\nif condition.clinicalStatus ~ \"active\"\n  or condition.clinicalStatus ~ \"recurrence\"\n  or condition.clinicalStatus ~ \"relapse\" then\n  Interval[start of condition.onset.toInterval(), end of condition.abatementInterval()]\nelse\n  Interval[start of condition.onset.toInterval(), end of condition.abatementInterval())"},{"url":"displaySequence","valueInteger":4}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DataRequirementHelper"},{"url":"name","valueString":"toInterval"},{"url":"statement","valueString":"define fluent function toInterval(choice Choice<DateTime, Quantity, Interval<DateTime>, Interval<Quantity>>):\n  case\n    when choice is DateTime then Interval[choice as DateTime, choice as DateTime]\n    else null as Interval<DateTime>end"},{"url":"displaySequence","valueInteger":5}]},{"url":"http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-logicDefinition","extension":[{"url":"libraryName","valueString":"DataRequirementHelper"},{"url":"name","valueString":"abatementInterval"},{"url":"statement","valueString":"define fluent function abatementInterval(condition Condition):\n\tInterval[condition.abatement.low, condition.abatement.high)"},{"url":"displaySequence","valueInteger":6}]}],"status":"active","type":{"coding":[{"system":"http://terminology.hl7.org/CodeSystem/library-type","code":"module-definition"}]},"relatedArtifact":[{"type":"depends-on","display":"Library DoubleFunctionHelpers","resource":"http://fhir.org/guides/cdc/opioid-cds/Library/DoubleFunctionHelpers|4.3.000"},{"type":"depends-on","display":"Library FHIRHelpers","resource":"http://hl7.org/fhir/Library/FHIRHelpers"},{"type":"depends-on","display":"Library FHIRHelpers","resource":"http://fhir.org/guides/cdc/opioid-cds/Library/FHIRHelpers|4.3.000"},{"type":"depends-on","display":"Code system ConditionClinicalStatusCodes","resource":"http://terminology.hl7.org/CodeSystem/condition-clinical"},{"type":"depends-on","display":"Value set Retrieve VS","resource":"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.600.1.1623"}],"parameter":[{"name":"Measurement Period","use":"in","min":0,"max":"1","type":"Period"},{"name":"Patient","use":"out","min":0,"max":"1","type":"Resource"},{"name":"Retrieve Def","use":"out","min":0,"max":"*","type":"Resource"}],"dataRequirement":[{"type":"Patient","profile":["http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient"]},{"type":"Condition","profile":["http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition"],"mustSupport":["code","clinicalStatus","onset","abatement","abatement.low","abatement.high"],"codeFilter":[{"path":"code","valueSet":"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.600.1.1623"}]}]}
